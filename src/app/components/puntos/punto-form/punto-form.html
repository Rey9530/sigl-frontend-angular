<div class="container-fluid">
  <div class="row">
    <div class="col-12 col-lg-8 col-xl-6">
      <div class="card">
        <div class="card-header">
          <h5>{{ isEditMode ? 'Editar Punto' : 'Nuevo Punto' }}</h5>
        </div>
        <div class="card-body">
          @if (loading) {
            <div class="text-center py-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
              </div>
            </div>
          } @else {
            <form [formGroup]="form" (ngSubmit)="onSubmit()">
              <div class="row">
                <div class="col-md-8 mb-3">
                  <label class="form-label">Nombre *</label>
                  <input type="text" class="form-control" formControlName="nombre"
                         placeholder="Ej: Sucursal San Salvador Centro"
                         [ngClass]="{'is-invalid': form.get('nombre')?.touched && form.get('nombre')?.invalid}">
                  @if (form.get('nombre')?.touched && form.get('nombre')?.errors?.['required']) {
                    <div class="invalid-feedback">El nombre es requerido</div>
                  }
                  @if (form.get('nombre')?.touched && form.get('nombre')?.errors?.['minlength']) {
                    <div class="invalid-feedback">El nombre debe tener al menos 2 caracteres</div>
                  }
                </div>

                <div class="col-md-4 mb-3">
                  <label class="form-label">Codigo *</label>
                  <input type="text" class="form-control" formControlName="codigo"
                         placeholder="Ej: SS01"
                         [ngClass]="{'is-invalid': form.get('codigo')?.touched && form.get('codigo')?.invalid}">
                  @if (form.get('codigo')?.touched && form.get('codigo')?.errors?.['required']) {
                    <div class="invalid-feedback">El codigo es requerido</div>
                  }
                  @if (form.get('codigo')?.touched && form.get('codigo')?.errors?.['minlength']) {
                    <div class="invalid-feedback">El codigo debe tener al menos 2 caracteres</div>
                  }
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label">Direccion *</label>
                <input type="text" class="form-control" formControlName="direccion"
                       placeholder="Ej: Blvd. Los Heroes #123, Col. Centro"
                       [ngClass]="{'is-invalid': form.get('direccion')?.touched && form.get('direccion')?.invalid}">
                @if (form.get('direccion')?.touched && form.get('direccion')?.errors?.['required']) {
                  <div class="invalid-feedback">La direccion es requerida</div>
                }
                @if (form.get('direccion')?.touched && form.get('direccion')?.errors?.['minlength']) {
                  <div class="invalid-feedback">La direccion debe tener al menos 5 caracteres</div>
                }
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Ciudad</label>
                  <input type="text" class="form-control" formControlName="ciudad"
                         placeholder="Ej: San Salvador">
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Departamento</label>
                  <select class="form-select" formControlName="departamento">
                    <option value="">Seleccione un departamento</option>
                    @for (depto of departamentos; track depto) {
                      <option [value]="depto">{{ depto }}</option>
                    }
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Telefono</label>
                  <input type="text" class="form-control" formControlName="telefono"
                         placeholder="Ej: 2222-3333">
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Email</label>
                  <input type="email" class="form-control" formControlName="email"
                         placeholder="Ej: sucursal@sigl.com"
                         [ngClass]="{'is-invalid': form.get('email')?.touched && form.get('email')?.invalid}">
                  @if (form.get('email')?.touched && form.get('email')?.errors?.['email']) {
                    <div class="invalid-feedback">Email invalido</div>
                  }
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label">Horario de Atencion</label>
                <input type="text" class="form-control" formControlName="horario"
                       placeholder="Ej: Lunes a Viernes 8:00 AM - 5:00 PM">
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Latitud</label>
                  <input type="number" step="any" class="form-control" formControlName="latitud"
                         placeholder="Ej: 13.6929">
                  <small class="text-muted">Coordenada GPS (opcional)</small>
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Longitud</label>
                  <input type="number" step="any" class="form-control" formControlName="longitud"
                         placeholder="Ej: -89.2182">
                  <small class="text-muted">Coordenada GPS (opcional)</small>
                </div>
              </div>

              <div class="d-flex gap-2 mt-4">
                <button type="submit" class="btn btn-primary" [disabled]="submitting">
                  @if (submitting) {
                    <span class="spinner-border spinner-border-sm me-1"></span>
                  }
                  {{ isEditMode ? 'Actualizar' : 'Crear' }}
                </button>
                <button type="button" class="btn btn-secondary" (click)="cancelar()">
                  Cancelar
                </button>
              </div>
            </form>
          }
        </div>
      </div>
    </div>
  </div>
</div>
